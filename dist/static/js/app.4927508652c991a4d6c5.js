webpackJsonp([1],{"9M+g":function(e,t){},Jmt5:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("7+uW"),i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var r=s("VU/8")({name:"App"},i,!1,function(e){s("Pe99")},null,null).exports,o=s("/ocq"),n=s("e6fC"),l=s.n(n),c=(s("Jmt5"),s("9M+g"),s("ao2D"),s("fZjL")),u=s.n(c),m=firebase.database().ref("/userAccount/"),d={data:function(){return{username:"",password:"",loginSuccess:!1,allUserList:[],message:""}},methods:{login:function(){for(var e=this,t=e.username,s=e.password,a=e.allUserList,i=0;i<a.length;i++){var r=a[i];t===r.username&&s===r.password?(e.setCookie("name",t,30),e.$router.push("/chatRoom")):(e.message="帳號或密碼有誤!",this.$refs.msgModal.show())}},setCookie:function(e,t,s){var a=new Date;a.setTime(a.getTime()+1e3*s*60*60*24);var i="expires="+a.toUTCString();document.cookie=e+"="+t+";"+i+";path/",console.log(document.cookie)}},mounted:function(){var e=this;m.on("value",function(t){var s=t.val();u()(s).forEach(function(t){var a=s[t];u()(a).forEach(function(t){e.allUserList.push(a[t])})}),console.log(e.allUserList)})}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-container",{staticClass:"col-xs-4 col-md-4"},[s("h2",[s("b-badge",{attrs:{variant:"success"}},[e._v("Login")])],1),e._v(" "),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Username"}},[s("b-form-input",{model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),e._v(" "),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Password"}},[s("b-form-input",{attrs:{type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),s("b-input-group-append",[s("b-button",{attrs:{variant:"outline-primary"}},[s("i",{staticClass:"fa fa-eye"})])],1)],1),e._v(" "),s("b-row",{staticClass:"mt-3"},[s("b-input-group",{staticClass:"col-xs-8 col-md-8"},[s("b-button",{attrs:{variant:"info"},on:{click:function(t){return e.login()}}},[e._v("登入")])],1),e._v(" "),s("b-input-group",{staticClass:"col-xs-4 col-md-4"},[s("router-link",{attrs:{to:"/register"}},[e._v("註冊")])],1)],1),e._v(" "),s("b-modal",{ref:"msgModal",attrs:{title:"Infomation","ok-only":""}},[e._v("\n      "+e._s(e.message)+"\n  ")])],1)},staticRenderFns:[]};var v=s("VU/8")(d,g,!1,function(e){s("rXq9")},null,null).exports,h=s("Dd8w"),f=s.n(h),p=firebase.database().ref("/messages/"),_=firebase.storage().ref("/users/"),b=firebase.database().ref("/userProfile/"),w=firebase.storage().ref("/images/"),y={name:"ChatRoom",data:function(){return{hoverMessageId:null,userName:"",messages:[],upload:!1,progress:"",currentMsgID:"",messageModalBlock:!1,modalMessage:"",userList:null,userPic:"",viewModal:!1,viewImage:"",viewImageTitle:"",otherUserPic:"https://github.com/subcrew692/VueSimpleChat/blob/master/src/assets/user.png?raw=true",selectOtherUser:"",firstOpen:!0,viewOtherUserModal:!1,viewOtherUserModalTitle:"",viewOtherUserHeadPicture:""}},methods:{saveName:function(e){var t="";null!==e?t=e:(console.log("bad bad"),this.$router.push("/")),this.userName=t,this.getUserHeadPicture()},getUserHeadPicture:function(){var e=this,t=e.userName;b.on("value",function(t){var s=t.val();null!==s&&void 0!==s&&(e.userList=s)});var s="",a=!1;if(null!=e.userList)for(var i in e.userList)if(t===i){console.log("this user has picture");var r=e.userList[i];for(var o in r)s<o&&(s=o,e.userPic=r[o].pictureURL,a=!0);break}e.userPic=a?e.userPic:e.otherUserPic},getTime:function(){var e=new Date,t=e.getHours(),s=e.getMinutes();return(t>=12?"下午":"上午")+" "+t+":"+(s<10?"0"+s:s)},sendMessage:function(e){var t=this.userName,s=document.querySelector("#js-message");return!e.shiftKey&&(s.value.length<=1&&""==s.value.trim()?(e.preventDefault(),!1):(p.push({userName:t,type:"text",message:s.value,headPicture:this.userPic,timeStamp:this.getTime()}),s.value="",this.scrollToBottom(),void e.preventDefault()))},sendImage:function(e,t){console.log(e);var s=this,a=s.userName,i=e.target.files[0],r=Math.floor(Date.now()/1e3)+"_"+i.name,o={contentType:"image/*"},n=document.querySelector("#js-progressBar"),l=w.child(r).put(i,o),c=_.child(r).put(i,o);if(t)l.on(firebase.storage.TaskEvent.STATE_CHANGED,function(e){var t=Math.floor(e.bytesTransferred/e.totalBytes*100);t<100&&(s.upload=!0,s.progress=t+"%",n.setAttribute("style","width:"+t+"%"))},function(e){p.child("bug/").push({userName:a,type:"image",message:e.code,timeStamp:s.getTime()})},function(){var e="";l.snapshot.ref.getDownloadURL().then(function(t){console.log("File available at",t),e=t,p.push({userName:a,type:"image",message:e,headPicture:s.userPic,timeStamp:s.getTime()})}),s.upload=!1}),s.scrollToBottom();else{var u=firebase.database().ref("/userProfile/"+a+"/");c.on(firebase.storage.TaskEvent.STATE_CHANGED,function(e){e.bytesTransferred<e.totalBytes&&(s.changeHeadPicModal=!1,s.messageModalBlock=!0,s.modalMessage="大頭貼上傳中...")},function(e){p.child("bug/").push({userName:a,type:"image",message:e.code,timeStamp:s.getTime()})},function(){var e="",t=new Date;c.snapshot.ref.getDownloadURL().then(function(i){console.log("File available at",i),e=i,u.push({userName:a,type:"image",pictureURL:e,timeStamp:t}),s.messageModalBlock=!1,s.modalMessage="",s.getUserHeadPicture()})}),s.scrollToBottom()}},deleteMessage:function(e){p.child(e).remove()},readMore:function(e){e.target.previousElementSibling.setAttribute("style","max-height: 100%;"),e.target.setAttribute("style","display: none;")},viewHeadPicture:function(){if(this.viewImage=this.userPic,this.viewImageTitle="大頭貼檢視",""!==this.selectOtherUser){console.log(this.selectOtherUser);for(var e=0;e<this.messages.length;e++)this.messages[e].id===this.selectOtherUser&&(this.viewImage=this.messages[e].headPicture)}this.viewModal=!0},clickImageMessage:function(e){this.currentMsgID=e,this.viewImage=this.userPic,this.viewImageTitle="圖片預覽";for(var t=0;t<this.messages.length;t++)this.messages[t].id===e&&(this.viewImage=this.messages[t].message);this.viewModal=!0},viewOtherUser:function(e){this.viewOtherUserModalTitle=e.userName,this.viewOtherUserHeadPicture=e.headPicture,this.viewOtherUserModal=!0},downloadImage:function(){},getCookie:function(e){var t=e;console.log(document.cookie);for(var s=document.cookie.split(";"),a=0;a<s.length;a++){for(var i=s[a];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return i.substring(t.length+1,i.length)}return""},deleteAllCookies:function(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var s=e[t],a=s.indexOf("="),i=a>-1?s.substr(0,a):s;document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}},scrollToBottom:function(){var e=document.querySelector("#js-roomBody");e.scrollTop=e.scrollHeight},logOut:function(){this.deleteAllCookies(),this.$router.push("/")}},mounted:function(){var e=this;p.on("value",function(t){var s=t.val(),a=s?u()(s).map(function(e){return f()({id:e},s[e])}):null;e.messages=a}),b.on("value",function(t){var s=t.val();if(null!==s&&void 0!==s){e.userList=s;var a=e.getCookie("name");a?e.saveName(a):e.$router.push("/")}})},updated:function(){document.querySelectorAll(".messageBox__message").forEach(function(e){e.offsetHeight>300&&e.querySelector(".message__readMore").setAttribute("style","display: block")}),this.firstOpen&&(this.scrollToBottom(),this.firstOpen=!1)}},C={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-container",{staticClass:"col-5",staticStyle:{"font-family":"courier new"}},[s("b-card",{staticClass:"cardWithoutBorder mb-3",attrs:{"img-src":e.userPic,"img-width":"70","img-height":"70","img-alt":"Card image","img-right":""}},[s("b-card-text",{staticClass:"text-left"},[e._v("Welcome to ChatRoom! "+e._s(e.userName))])],1),e._v(" "),s("b-card",{staticClass:"roomHeadView"},[s("b-media",[s("b-img",{attrs:{slot:"aside",alt:"placeholder",src:"https://github.com/subcrew692/VueSimpleChat/blob/master/src/assets/user.png?raw=true",width:"50",height:"50"},slot:"aside"}),e._v(" "),s("h5",{staticClass:"mt-0",attrs:{slot:"aside"},slot:"aside"},[e._v("Test Room")]),e._v(" "),s("div",{staticStyle:{"text-align":"right"}},[s("b-dropdown",{staticClass:"m-2",attrs:{id:"dropdown-right",right:"",text:"Setting",variant:"primary"}},[s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(t){return e.viewHeadPicture()}}},[e._v("檢視大頭貼")]),e._v(" "),s("b-dropdown-item",{attrs:{href:"#"}},[e._v("更新大頭貼")]),e._v(" "),s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(t){return e.changeCrewName()}}},[e._v("變更群組名稱")]),e._v(" "),s("b-dropdown-item",{attrs:{href:"#"}},[e._v("變更群組圖像")]),e._v(" "),s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(t){return e.logOut()}}},[e._v("登出")])],1)],1)],1)],1),e._v(" "),s("b-card",{staticClass:"roomBodyView",attrs:{id:"js-roomBody"}},[e._l(e.messages,function(t){return[t.userName!=e.userName?[s("b-media-aside",[s("b-img",{staticClass:"messageBox__user mt-3",attrs:{slot:"aside",src:null===t.headPicture?e.otherUserPic:t.headPicture},on:{click:function(s){return e.viewOtherUser(t)}},slot:"aside"}),e._v(" "),s("div",{staticClass:"messageBox__content"},[s("div",{staticClass:"messageBox__name"},[e._v(e._s(t.userName))]),e._v(" "),"text"==t.type?s("div",{staticClass:"messageBox__message"},[s("div",{staticClass:"messageBox__text"},[e._v(e._s(t.message))])]):e._e(),e._v(" "),"image"==t.type?s("div",{staticClass:"messageBox__image",on:{click:function(s){return e.clickImageMessage(t.id)}}},[s("img",{attrs:{src:t.message}})]):e._e(),e._v(" "),s("div",{staticClass:"messageBox__delete"})]),e._v(" "),s("div",{staticClass:"messageBox__time"},[e._v(e._s(t.timeStamp))])],1)]:e._e(),e._v(" "),t.userName==e.userName?[s("div",{key:t.id,staticClass:"messageBox messageBox--self",on:{mouseenter:function(s){e.hoverMessageId=t.id},mouseleave:function(t){e.hoverMessageId=null}}},[s("div",{staticClass:"messageBox__time"},[e._v(e._s(t.timeStamp))]),e._v(" "),s("div",{staticClass:"messageBox__content"},["text"==t.type?s("div",{staticClass:"messageBox__message",on:{click:function(s){e.currentMsgID=e.currentMsgID===t.id?"":t.id}}},[s("div",{staticClass:"messageBox__text",attrs:{id:t.id}},[e._v(e._s(t.message))])]):e._e(),e._v(" "),"image"==t.type?s("div",{staticClass:"messageBox__image",on:{click:function(s){return e.clickImageMessage(t.id)}}},[s("img",{attrs:{src:t.message}})]):e._e()]),e._v(" "),s("div",{staticClass:"messageBox__delete"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.currentMsgID===t.id,expression:"currentMsgID === item.id"}],on:{click:function(t){return e.deleteMessage(e.hoverMessageId)}}},[e._v("刪除")])])])]:e._e()]}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.upload,expression:"upload"}],staticClass:"messageBox messageBox--self"},[s("div",{staticClass:"messageBox__progress"},[s("div",{staticClass:"messageBox__progress--state",attrs:{id:"js-progressBar"}}),e._v(" "),s("div",{staticClass:"messageBox__progress--number"},[e._v(e._s(e.progress))])])])],2),e._v(" "),s("b-card",{staticClass:"roomBottom"},[s("b-card-header",{staticClass:"disablePadding"},[s("div",{staticClass:"roomBottom__tools_upload"},[s("label",{staticClass:"file-upload-style",attrs:{for:"file-upload",title:"選擇檔案"}},[s("i",{staticClass:"fa fa-paperclip"})]),e._v(" "),s("input",{attrs:{type:"file",id:"file-upload",accept:"image/*"},on:{change:function(t){return e.sendImage(t,!0)}}})])]),e._v(" "),s("div",{staticClass:"roomBottom__input"},[s("textarea",{staticClass:"roomBottom__input__textarea",class:{disable:!e.userName},attrs:{id:"js-message"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t)}}})])],1),e._v(" "),s("b-modal",{attrs:{title:e.viewImageTitle,size:"lg"},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var a=t.ok;return[s("b-button",{attrs:{size:"sm",href:e.viewImage,download:"vueSimpleChatDownload"}},[e._v("Download")]),e._v(" "),s("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(e){return a()}}},[e._v("OK")])]}}]),model:{value:e.viewModal,callback:function(t){e.viewModal=t},expression:"viewModal"}},[s("template",{slot:"default"},[s("img",{staticStyle:{"max-width":"750px"},attrs:{src:e.viewImage}})])],2),e._v(" "),s("b-modal",{attrs:{title:e.viewOtherUserModalTitle,"hide-footer":""},model:{value:e.viewOtherUserModal,callback:function(t){e.viewOtherUserModal=t},expression:"viewOtherUserModal"}},[s("img",{staticClass:"view-other-user-picture",attrs:{src:e.viewOtherUserHeadPicture}})])],1)},staticRenderFns:[]};var x=s("VU/8")(y,C,!1,function(e){s("y4U9")},null,null).exports;Date.prototype.yyyymmddByDash=function(){var e=this.getFullYear(),t=this.getMonth()<9?"0"+(this.getMonth()+1):this.getMonth()+1,s=this.getDate()<10?"0"+this.getDate():this.getDate();return"".concat(e).concat("-").concat(t).concat("-").concat(s)};var k=firebase.database().ref("/userAccount/"),M={data:function(){return{username:"",password:"",email:"",usernamePass:"",passwordPass:"",emailPass:"",allUserList:[],message:""}},methods:{validationUsername:function(){this.usernamePass=this.username.length>3&&this.username.length<15},validationPassword:function(){this.passwordPass=this.password.length>3&&this.password.length<15},validationEmail:function(){this.emailPass=this.email.length>5},register:function(){var e=this,t=this,s=t.username,a=t.password,i=t.email;t.validationInput()?k.child(s+"/").push({username:s,password:a,email:i,timeStamp:(new Date).yyyymmddByDash()}).then(function(){e.message="註冊成功!",e.$refs.msgModal.show(),t.$router.push("/")}).catch(function(e){return console.log("error")}):this.$refs.msgModal.show()},validationInput:function(){var e=this.allUserList,t=this.username,s=this.password,a=this.email,i=!0;if(t&&s&&a){for(var r=0;r<e.length;r++)e[r]===t&&(this.message="username has been taken, please change one",i=!1);return i}return this.message="input wrong",i=!1}},mounted:function(){var e=this;k.on("value",function(t){var s=t.val();u()(s).forEach(function(t){var a=s[t];u()(a).forEach(function(t){e.allUserList.push(a[t].username)})})})}},P={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-container",{staticClass:"col-4"},[s("h2",[s("b-badge",{attrs:{variant:"success"}},[e._v("Register")])],1),e._v(" "),s("b-form",[s("div",{staticStyle:{"text-align":"left"}},[s("i",{staticClass:"fa fa-user"}),e._v(" Username: \n          "),s("b-input",{staticClass:"mb-3",attrs:{state:e.usernamePass,placeholder:"請輸入5-15位英數字..."},on:{change:function(t){return e.validationUsername()}},model:{value:e.username,callback:function(t){e.username="string"==typeof t?t.trim():t},expression:"username"}}),e._v(" "),s("i",{staticClass:"fa fa-lock"}),e._v(" Password: \n          "),s("b-input",{staticClass:"mb-3",attrs:{type:"password",state:e.passwordPass,placeholder:"請輸入6-20位英數字..."},on:{change:function(t){return e.validationPassword()}},model:{value:e.password,callback:function(t){e.password="string"==typeof t?t.trim():t},expression:"password"}}),e._v(" "),s("i",{staticClass:"fa fa-envelope"}),e._v(" Email address:\n          "),s("b-input",{staticClass:"mb-3",attrs:{type:"email",state:e.emailPass,placeholder:"請輸入Email..."},on:{change:function(t){return e.validationEmail()}},model:{value:e.email,callback:function(t){e.email="string"==typeof t?t.trim():t},expression:"email"}}),e._v(" "),s("div",{staticStyle:{"text-align":"right"}},[s("router-link",{attrs:{to:"/"}},[e._v("回登入頁面")]),e._v(" "),s("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.register()}}},[e._v("註冊")])],1)],1)]),e._v(" "),s("b-modal",{ref:"msgModal",attrs:{title:"Infomation","ok-only":""}},[e._v("\n      "+e._s(e.message)+"\n  ")])],1)},staticRenderFns:[]};var U=s("VU/8")(M,P,!1,function(e){s("ea1N")},null,null).exports;a.default.use(l.a),a.default.use(o.a);var B=new o.a({routes:[{path:"/",name:"LoginPage",component:v},{path:"/chatRoom",name:"ChatRoom",component:x},{path:"/register",name:"Register",component:U}]});a.default.config.productionTip=!1,new a.default({el:"#app",router:B,components:{App:r},template:"<App/>"})},Pe99:function(e,t){},ao2D:function(e,t){},ea1N:function(e,t){},rXq9:function(e,t){},y4U9:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.4927508652c991a4d6c5.js.map