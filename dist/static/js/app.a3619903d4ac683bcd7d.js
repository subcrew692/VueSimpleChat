webpackJsonp([1],{"/nQO":function(e,t){},"0mQA":function(e,t){},"9M+g":function(e,t){},Jmt5:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("7+uW"),i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var r=s("VU/8")({name:"App"},i,!1,function(e){s("0mQA")},null,null).exports,o=s("/ocq"),n=s("e6fC"),l=s.n(n),u=(s("Jmt5"),s("9M+g"),s("ao2D"),s("fZjL")),c=s.n(u),m=firebase.database().ref("/userAccount/"),d={data:function(){return{username:"",password:"",loginSuccess:!1,allUserList:[],message:""}},methods:{login:function(){for(var e=this,t=e.username,s=e.password,a=e.allUserList,i=0;i<a.length;i++){var r=a[i];t===r.username&&s===r.password?(e.setCookie("name",t,30),e.$router.push("/chatRoom")):(e.message="帳號或密碼有誤!",this.$refs.msgModal.show())}},setCookie:function(e,t,s){var a=new Date;a.setTime(a.getTime()+1e3*s*60*60*24);var i="expires="+a.toUTCString();document.cookie=e+"="+t+";"+i+";path/",console.log(document.cookie)}},mounted:function(){var e=this;m.on("value",function(t){var s=t.val();c()(s).forEach(function(t){var a=s[t];c()(a).forEach(function(t){e.allUserList.push(a[t])})}),console.log(e.allUserList)})}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-container",{staticClass:"col-md-4"},[s("h2",[s("b-badge",{attrs:{variant:"success"}},[e._v("Login")])],1),e._v(" "),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Username"}},[s("b-form-input",{model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),e._v(" "),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Password"}},[s("b-form-input",{attrs:{type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),s("b-input-group-append",[s("b-button",{attrs:{variant:"outline-primary"}},[s("i",{staticClass:"fa fa-eye"})])],1)],1),e._v(" "),s("b-row",{staticClass:"mt-3"},[s("b-input-group",{staticClass:"col-md-8"},[s("b-button",{attrs:{variant:"info"},on:{click:function(t){return e.login()}}},[e._v("登入")])],1),e._v(" "),s("b-input-group",{staticClass:"col-md-4"},[s("router-link",{attrs:{to:"/register"}},[e._v("註冊")])],1)],1),e._v(" "),s("b-modal",{ref:"msgModal",attrs:{title:"Infomation","ok-only":""}},[e._v("\n      "+e._s(e.message)+"\n  ")])],1)},staticRenderFns:[]};var p=s("VU/8")(d,g,!1,function(e){s("/nQO")},null,null).exports,f=s("Dd8w"),v=s.n(f),h=s("ZZvs"),_=s.n(h),b=(s("SYh3"),firebase.database().ref("/messages/")),y=firebase.storage().ref("/users/"),w=firebase.database().ref("/userProfile/"),C=firebase.storage().ref("/images/"),I=firebase.database().ref("/groupInfo/"),M=firebase.storage().ref("/groupImages/"),k={name:"ChatRoom",components:{loading:_.a},data:function(){return{hoverMessageId:null,groupName:"",groupImage:"",userName:"",messages:[],upload:!1,progress:"",currentMsgID:"",isLoading:!1,isChangeHeadPic:!1,userList:null,userPic:"",viewModal:!1,viewImage:"",viewImageTitle:"",otherUserPic:"https://github.com/subcrew692/VueSimpleChat/blob/master/src/assets/user.png?raw=true",selectOtherUser:"",firstOpen:!0,viewOtherUserModal:!1,viewOtherUserModalTitle:"",viewOtherUserHeadPicture:"",modifyGroupModal:!1,modifyGroupName:"",modifyGroupNameMsg:"",modifyGroupImage:null,previewGroupImageSrc:"",tempImage:null}},methods:{saveName:function(e){var t="";null!==e?t=e:(console.log("bad bad"),this.$router.push("/")),this.userName=t,this.getUserHeadPicture()},getUserHeadPicture:function(){var e=this,t=e.userName;w.on("value",function(t){var s=t.val();null!==s&&void 0!==s&&(e.userList=s)});var s="",a=!1;if(null!=e.userList)for(var i in e.userList)if(t===i){console.log("this user has picture");var r=e.userList[i];for(var o in r)s<o&&(s=o,e.userPic=r[o].pictureURL,a=!0);break}e.userPic=a?e.userPic:e.otherUserPic},getTime:function(){var e=new Date,t=e.getHours(),s=e.getMinutes();return(t>=12?"下午":"上午")+" "+t+":"+(s<10?"0"+s:s)},sendMessage:function(e){var t=this.userName,s=document.querySelector("#js-message");return!e.shiftKey&&(s.value.length<=1&&""==s.value.trim()?(e.preventDefault(),!1):(b.push({userName:t,type:"text",message:s.value,headPicture:this.userPic,timeStamp:this.getTime()}),s.value="",this.scrollToBottom(),void e.preventDefault()))},uploadGroupImage:function(e){var t=this;if(t.tempImage=e.target.files[0],t.tempImage){var s=new FileReader;s.onload=function(e){t.previewGroupImageSrc=e.target.result},s.readAsDataURL(t.tempImage)}},confirmGroupNameModify:function(){var e=this;if(e.modifyGroupName||e.modifyGroupImage){if(e.modifyGroupName)firebase.database().ref("/groupInfo/Names/").push({groupName:e.modifyGroupName,editer:e.userName}),e.modifyGroupNameMsg="",e.modifyGroupModal=!1;if(e.modifyGroupImage){var t=firebase.database().ref("/groupInfo/Images/"),s=e.tempImage,a=Math.floor(Date.now()/1e3)+"_"+s.name,i=M.child(a).put(s,{contentType:"image/*"});i.on(firebase.storage.TaskEvent.STATE_CHANGED,function(t){t.bytesTransferred<t.totalBytes&&(e.isLoading=!0)},function(t){b.child("bug/").push({userName:e.userName,type:"image",message:t.code,timeStamp:e.getTime()})},function(){var s="",a=new Date;i.snapshot.ref.getDownloadURL().then(function(i){console.log("Group image file available at",i),s=i,t.push({editer:e.userName,type:"image",pictureURL:s,timeStamp:a}),e.isLoading=!1})})}e.modifyGroupModal=!1,e.modifyGroupName="",e.modifyGroupNameMsg="",e.modifyGroupImage=null,e.previewGroupImageSrc=""}else e.modifyGroupNameMsg="若要修改，名稱或圖片不得為空"},changeHeadPic:function(){document.getElementById("headPicInput").click()},sendImage:function(e,t){console.log(e);var s=this,a=s.userName,i=e.target.files[0],r=Math.floor(Date.now()/1e3)+"_"+i.name,o={contentType:"image/*"},n=document.querySelector("#js-progressBar"),l=C.child(r).put(i,o),u=y.child(r).put(i,o);if(t)l.on(firebase.storage.TaskEvent.STATE_CHANGED,function(e){var t=Math.floor(e.bytesTransferred/e.totalBytes*100);t<100&&(s.upload=!0,s.progress=t+"%",n.setAttribute("style","width:"+t+"%"))},function(e){b.child("bug/").push({userName:a,type:"image",message:e.code,timeStamp:s.getTime()})},function(){var e="";l.snapshot.ref.getDownloadURL().then(function(t){console.log("File available at",t),e=t,b.push({userName:a,type:"image",message:e,headPicture:s.userPic,timeStamp:s.getTime()})}),s.upload=!1,s.scrollToBottom()});else{var c=firebase.database().ref("/userProfile/"+a+"/");s.viewModal=!1,u.on(firebase.storage.TaskEvent.STATE_CHANGED,function(e){e.bytesTransferred<e.totalBytes&&(s.isLoading=!0)},function(e){b.child("bug/").push({userName:a,type:"image",message:e.code,timeStamp:s.getTime()})},function(){var e="",t=new Date;u.snapshot.ref.getDownloadURL().then(function(i){console.log("File available at",i),e=i,c.push({userName:a,type:"image",pictureURL:e,timeStamp:t}),s.isLoading=!1,s.getUserHeadPicture()})})}},deleteMessage:function(e){b.child(e).remove()},readMore:function(e){e.target.previousElementSibling.setAttribute("style","max-height: 100%;"),e.target.setAttribute("style","display: none;")},viewHeadPicture:function(){if(this.viewImage=this.userPic,this.viewImageTitle="大頭貼檢視",""!==this.selectOtherUser){console.log(this.selectOtherUser);for(var e=0;e<this.messages.length;e++)this.messages[e].id===this.selectOtherUser&&(this.viewImage=this.messages[e].headPicture)}this.viewModal=!0},clickImageMessage:function(e){this.currentMsgID=e,this.viewImage=this.userPic,this.viewImageTitle="圖片預覽";for(var t=0;t<this.messages.length;t++)this.messages[t].id===e&&(this.viewImage=this.messages[t].message);this.viewModal=!0},viewOtherUser:function(e){this.viewOtherUserModalTitle=e.userName,this.viewOtherUserHeadPicture=e.headPicture,this.viewOtherUserModal=!0},getCookie:function(e){var t=e;console.log(document.cookie);for(var s=document.cookie.split(";"),a=0;a<s.length;a++){for(var i=s[a];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return i.substring(t.length+1,i.length)}return""},deleteAllCookies:function(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var s=e[t],a=s.indexOf("="),i=a>-1?s.substr(0,a):s;document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}},scrollToBottom:function(){var e=document.querySelector("#js-roomBody");e.scrollTop=e.scrollHeight},logOut:function(){this.deleteAllCookies(),this.$router.push("/")}},mounted:function(){var e=this;b.on("value",function(t){var s=t.val(),a=s?c()(s).map(function(e){return v()({id:e},s[e])}):null;e.messages=a}),w.on("value",function(t){var s=t.val();if(null!==s&&void 0!==s){e.userList=s;var a=e.getCookie("name");a?e.saveName(a):e.$router.push("/")}}),I.on("value",function(t){var s=t.val(),a=s.Names?c()(s.Names).map(function(e){return v()({id:e},s.Names[e])}):null,i=s.Images?c()(s.Images).map(function(e){return v()({id:e},s.Images[e])}):null;e.groupName=a[a.length-1].groupName,e.groupImage=i[i.length-1].pictureURL})},updated:function(){document.querySelectorAll(".messageBox__message").forEach(function(e){e.offsetHeight>300&&e.querySelector(".message__readMore").setAttribute("style","display: block")}),this.firstOpen&&(this.scrollToBottom(),this.firstOpen=!1)}},x={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-container",{staticClass:"col-md-5",staticStyle:{"font-family":"courier new"}},[s("loading",{attrs:{loader:"bars",active:e.isLoading,"can-cancel":!0,"is-full-page":!1},on:{"update:active":function(t){e.isLoading=t}}}),e._v(" "),s("b-card",{staticClass:"cardWithoutBorder mb-3",attrs:{"img-src":e.userPic,"img-width":"70","img-height":"70","img-alt":"Card image","img-right":""}},[s("b-card-text",{staticClass:"text-left"},[e._v("Welcome to "+e._s(e.groupName)+"! "+e._s(e.userName))])],1),e._v(" "),s("b-card",{staticClass:"roomHeadView"},[s("b-media",[""!==e.groupImage?s("b-img",{attrs:{slot:"aside",alt:"placeholder",src:e.groupImage,width:"50",height:"50"},slot:"aside"}):e._e(),e._v(" "),s("h5",{staticClass:"mt-0",attrs:{slot:"aside"},slot:"aside"},[e._v(e._s(e.groupName))]),e._v(" "),s("div",{staticStyle:{"text-align":"right"}},[s("b-dropdown",{staticClass:"m-2",attrs:{id:"dropdown-right",right:"",text:"Setting",variant:"primary"}},[s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(t){e.viewHeadPicture(),e.isChangeHeadPic=!0}}},[e._v("大頭貼檢視/更新")]),e._v(" "),s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(t){e.modifyGroupModal=!0}}},[e._v("編輯群組")]),e._v(" "),s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(t){return e.logOut()}}},[e._v("登出")])],1)],1)],1)],1),e._v(" "),s("b-card",{staticClass:"roomBodyView",attrs:{id:"js-roomBody"}},[e._l(e.messages,function(t){return[t.userName!=e.userName?[s("b-media-aside",[s("b-img",{staticClass:"messageBox__user mt-3",attrs:{slot:"aside",src:null===t.headPicture?e.otherUserPic:t.headPicture},on:{click:function(s){return e.viewOtherUser(t)}},slot:"aside"}),e._v(" "),s("div",{staticClass:"messageBox__content"},[s("div",{staticClass:"messageBox__name"},[e._v(e._s(t.userName))]),e._v(" "),"text"==t.type?s("div",{staticClass:"messageBox__message"},[s("div",{staticClass:"messageBox__text"},[e._v(e._s(t.message))])]):e._e(),e._v(" "),"image"==t.type?s("div",{staticClass:"messageBox__image",on:{click:function(s){e.clickImageMessage(t.id),e.isChangeHeadPic=!1}}},[s("img",{attrs:{src:t.message}})]):e._e(),e._v(" "),s("div",{staticClass:"messageBox__delete"})]),e._v(" "),s("div",{staticClass:"messageBox__time"},[e._v(e._s(t.timeStamp))])],1)]:e._e(),e._v(" "),t.userName==e.userName?[s("div",{key:t.id,staticClass:"messageBox messageBox--self",on:{mouseenter:function(s){e.hoverMessageId=t.id},mouseleave:function(t){e.hoverMessageId=null}}},[s("div",{staticClass:"messageBox__time"},[e._v(e._s(t.timeStamp))]),e._v(" "),s("div",{staticClass:"messageBox__content"},["text"==t.type?s("div",{staticClass:"messageBox__message",on:{click:function(s){e.currentMsgID=e.currentMsgID===t.id?"":t.id}}},[s("div",{staticClass:"messageBox__text",attrs:{id:t.id}},[e._v(e._s(t.message))])]):e._e(),e._v(" "),"image"==t.type?s("div",{staticClass:"messageBox__image",on:{click:function(s){e.clickImageMessage(t.id),e.isChangeHeadPic=!1}}},[s("img",{attrs:{src:t.message}})]):e._e()]),e._v(" "),s("div",{staticClass:"messageBox__delete"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.currentMsgID===t.id,expression:"currentMsgID === item.id"}],on:{click:function(t){return e.deleteMessage(e.hoverMessageId)}}},[e._v("刪除")])])])]:e._e()]}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.upload,expression:"upload"}],staticClass:"messageBox messageBox--self"},[s("div",{staticClass:"messageBox__progress"},[s("div",{staticClass:"messageBox__progress--state",attrs:{id:"js-progressBar"}}),e._v(" "),s("div",{staticClass:"messageBox__progress--number"},[e._v(e._s(e.progress))])])])],2),e._v(" "),s("b-card",{staticClass:"roomBottom"},[s("b-card-header",{staticClass:"disablePadding"},[s("div",{staticClass:"roomBottom__tools_upload"},[s("label",{staticClass:"file-upload-style",attrs:{for:"file-upload",title:"選擇檔案"}},[s("i",{staticClass:"fa fa-paperclip"})]),e._v(" "),s("input",{attrs:{type:"file",id:"file-upload",accept:"image/*"},on:{change:function(t){return e.sendImage(t,!0)}}})])]),e._v(" "),s("div",{staticClass:"roomBottom__input"},[s("textarea",{staticClass:"roomBottom__input__textarea",class:{disable:!e.userName},attrs:{id:"js-message"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t)}}})])],1),e._v(" "),s("b-modal",{attrs:{title:e.viewImageTitle,size:"lg"},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var a=t.ok;return[s("input",{attrs:{type:"file",id:"headPicInput",accept:"image/*"},on:{change:function(t){return e.sendImage(t,!1)}}}),e._v(" "),e.isChangeHeadPic?s("b-button",{attrs:{size:"sm",variant:"success"},on:{click:function(t){return e.changeHeadPic()}}},[e._v("更換")]):e._e(),e._v(" "),s("b-button",{attrs:{size:"sm",href:e.viewImage,download:"vueSimpleChatDownload"}},[e._v("下載")]),e._v(" "),s("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(e){return a()}}},[e._v("OK")])]}}]),model:{value:e.viewModal,callback:function(t){e.viewModal=t},expression:"viewModal"}},[s("template",{slot:"default"},[s("img",{staticStyle:{"max-width":"100%"},attrs:{src:e.viewImage}})])],2),e._v(" "),s("b-modal",{attrs:{title:e.viewOtherUserModalTitle,"hide-footer":""},model:{value:e.viewOtherUserModal,callback:function(t){e.viewOtherUserModal=t},expression:"viewOtherUserModal"}},[s("img",{staticClass:"view-other-user-picture",attrs:{src:e.viewOtherUserHeadPicture}})]),e._v(" "),s("b-modal",{attrs:{title:"編輯群組"},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var a=t.ok;return[s("b-button",{attrs:{size:"sm"},on:{click:function(e){return a()}}},[e._v("取消")]),e._v(" "),s("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(t){return e.confirmGroupNameModify()}}},[e._v("確認")])]}}]),model:{value:e.modifyGroupModal,callback:function(t){e.modifyGroupModal=t},expression:"modifyGroupModal"}},[s("span",{staticStyle:{color:"red"}},[e._v(e._s(e.modifyGroupNameMsg))]),e._v(" "),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"名稱"}},[s("b-form-input",{attrs:{type:"text"},model:{value:e.modifyGroupName,callback:function(t){e.modifyGroupName=t},expression:"modifyGroupName"}})],1),e._v(" "),s("b-input-group",{staticClass:"mt-3"},[s("b-form-file",{attrs:{state:Boolean(e.modifyGroupImage),placeholder:"請點擊上傳圖片...","drop-placeholder":"將圖片拉至此處...",accept:"image/*","browse-text":"瀏覽"},on:{change:function(t){return e.uploadGroupImage(t)}},model:{value:e.modifyGroupImage,callback:function(t){e.modifyGroupImage=t},expression:"modifyGroupImage"}})],1),e._v(" "),s("hr"),e._v(" "),s("img",{staticStyle:{"max-width":"400px"},attrs:{src:e.previewGroupImageSrc}})],1)],1)},staticRenderFns:[]};var N=s("VU/8")(k,x,!1,function(e){s("PNi1")},null,null).exports;Date.prototype.yyyymmddByDash=function(){var e=this.getFullYear(),t=this.getMonth()<9?"0"+(this.getMonth()+1):this.getMonth()+1,s=this.getDate()<10?"0"+this.getDate():this.getDate();return"".concat(e).concat("-").concat(t).concat("-").concat(s)};var P=firebase.database().ref("/userAccount/"),U={data:function(){return{username:"",password:"",email:"",usernamePass:"",passwordPass:"",emailPass:"",allUserList:[],message:""}},methods:{validationUsername:function(){this.usernamePass=this.username.length>3&&this.username.length<15},validationPassword:function(){this.passwordPass=this.password.length>3&&this.password.length<15},validationEmail:function(){this.emailPass=this.email.length>5},register:function(){var e=this,t=this,s=t.username,a=t.password,i=t.email;t.validationInput()?P.child(s+"/").push({username:s,password:a,email:i,timeStamp:(new Date).yyyymmddByDash()}).then(function(){e.message="註冊成功!",e.$refs.msgModal.show(),t.$router.push("/")}).catch(function(e){return console.log("error")}):this.$refs.msgModal.show()},validationInput:function(){var e=this.allUserList,t=this.username,s=this.password,a=this.email,i=!0;if(t&&s&&a){for(var r=0;r<e.length;r++)e[r]===t&&(this.message="username has been taken, please change one",i=!1);return i}return this.message="input wrong",i=!1}},mounted:function(){var e=this;P.on("value",function(t){var s=t.val();c()(s).forEach(function(t){var a=s[t];c()(a).forEach(function(t){e.allUserList.push(a[t].username)})})})}},B={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-container",{staticClass:"col-4"},[s("h2",[s("b-badge",{attrs:{variant:"success"}},[e._v("Register")])],1),e._v(" "),s("b-form",[s("div",{staticStyle:{"text-align":"left"}},[s("i",{staticClass:"fa fa-user"}),e._v(" Username: \n          "),s("b-input",{staticClass:"mb-3",attrs:{state:e.usernamePass,placeholder:"請輸入5-15位英數字..."},on:{change:function(t){return e.validationUsername()}},model:{value:e.username,callback:function(t){e.username="string"==typeof t?t.trim():t},expression:"username"}}),e._v(" "),s("i",{staticClass:"fa fa-lock"}),e._v(" Password: \n          "),s("b-input",{staticClass:"mb-3",attrs:{type:"password",state:e.passwordPass,placeholder:"請輸入6-20位英數字..."},on:{change:function(t){return e.validationPassword()}},model:{value:e.password,callback:function(t){e.password="string"==typeof t?t.trim():t},expression:"password"}}),e._v(" "),s("i",{staticClass:"fa fa-envelope"}),e._v(" Email address:\n          "),s("b-input",{staticClass:"mb-3",attrs:{type:"email",state:e.emailPass,placeholder:"請輸入Email..."},on:{change:function(t){return e.validationEmail()}},model:{value:e.email,callback:function(t){e.email="string"==typeof t?t.trim():t},expression:"email"}}),e._v(" "),s("div",{staticStyle:{"text-align":"right"}},[s("router-link",{attrs:{to:"/"}},[e._v("回登入頁面")]),e._v(" "),s("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.register()}}},[e._v("註冊")])],1)],1)]),e._v(" "),s("b-modal",{ref:"msgModal",attrs:{title:"Infomation","ok-only":""}},[e._v("\n      "+e._s(e.message)+"\n  ")])],1)},staticRenderFns:[]};var G=s("VU/8")(U,B,!1,function(e){s("ea1N")},null,null).exports;a.default.use(l.a),a.default.use(o.a);var S=new o.a({routes:[{path:"/",name:"LoginPage",component:p},{path:"/chatRoom",name:"ChatRoom",component:N},{path:"/register",name:"Register",component:G}]});a.default.config.productionTip=!1,new a.default({el:"#app",router:S,components:{App:r},template:"<App/>"})},PNi1:function(e,t){},SYh3:function(e,t){},ao2D:function(e,t){},ea1N:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.a3619903d4ac683bcd7d.js.map